!function(o){"use strict";const t=dotinsights.BrowserUtil.isFirefox,e=dotinsights.Helpers.isHandheld();const n="dotinsightsWalletInfo",i={supportedWallets:{subwallet:{name:"SubWallet",type:"substrate",provider:"subwallet-js",logo:"",getInstallUrl:function(){return e?"https://mobile.subwallet.app/?url=https%3A%2F%2Fdotinsights.subwallet.app%2F":t?"https://mzl.la/3rQ0awW":"https://subwallet.app/download.html"}},"subwallet-evm":{name:"SubWallet - EVM",type:"evm",provider:"SubWallet",evmDetect:"isSubWallet",logo:"",getInstallUrl:function(){return e?"https://mobile.subwallet.app/?url=https%3A%2F%2Fdotinsights.subwallet.app%2F":t?"https://mzl.la/3rQ0awW":"https://subwallet.app/download.html"}},talisman:{name:"Talisman",type:"substrate",provider:"talisman",logo:"",getInstallUrl:function(){return"https://talisman.xyz/download"}},"talisman-evm":{name:"Talisman - EVM",type:"evm",provider:"talismanEth",evmDetect:"isTalisman",logo:"",getInstallUrl:function(){return"https://talisman.xyz/download"}},polkadot:{name:"Polkadot{.js}",type:"substrate",provider:"polkadot-js",logo:"",getInstallUrl:function(){return"https://polkadot.js.org/extension/"}},metamask:{name:"MetaMask",type:"evm",provider:"ethereum",evmDetect:"isMetaMask",logo:"",getInstallUrl:function(){return"https://metamask.io/download/"}}},currentWallet:null,currentWalletName:null,currentWalletType:"none",currentAddress:null,currentVoteAbility:!1,getSavedState:function(){var t=JSON.parse(localStorage.getItem(n))||{};return{currentWalletName:t.currentWalletName,currentAddress:t.currentAddress,currentSignMessage:t.currentSignMessage,currentVoteAbility:t.currentVoteAbility}},saveState:function(t){var e=i.getSavedState();t.hasOwnProperty("currentWalletName")&&(i.currentWalletName=t.currentWalletName,e.currentWalletName=t.currentWalletName),t.hasOwnProperty("currentAddress")&&(i.currentAddress=t.currentAddress,e.currentAddress=t.currentAddress),t.hasOwnProperty("currentSignMessage")&&(i.currentSignMessage=t.currentSignMessage,e.currentSignMessage=t.currentSignMessage),t.hasOwnProperty("currentVoteAbility")&&(i.currentVoteAbility=t.currentVoteAbility,e.currentVoteAbility=t.currentVoteAbility),localStorage.setItem(n,JSON.stringify(e))},resetState:function(){i.saveState({currentWalletName:null,currentAddress:null,currentSignMessage:void 0,currentVoteAbility:!1})},loadSavedState:function(){var t=i.getSavedState();Object.assign(i,t)},getCurrentWallet:async function(){if(i.loadSavedState(),i.currentWalletName&&i.currentAddress)return i.enableWallet(i.currentWalletName)},isInstall:function(t){return!!i.getWallet(t)},isConnectedWithWallet:async function(){return!!await dotinsights.walletUtils.getCurrentWallet()},getWallet:function(t){t=i.supportedWallets[t];if(t)return"evm"!==t.type?window.injectedWeb3&&window.injectedWeb3[t.provider]:window[t.provider]&&window[t.provider][t.evmDetect]?window[t.provider]:void 0},enableWallet:async function(n){const a=i.supportedWallets[n];if(!a)throw new Error("Wallet is not support");const r=i.getWallet(n);if(!r)throw new Error("Wallet is not install");return new Promise(function(e,t){!async function(){return"evm"===a.type?r.request({method:"eth_requestAccounts"}):r.enable()}().then(async t=>{i.currentWalletType=a.type,"evm"===a.type?i.currentWallet=r:i.currentWallet=t,i.currentWalletName!==n&&i.saveState({currentWalletName:n,currentAddress:void 0,currentSignMessage:void 0,currentVoteAbility:!1});t=await i.getAccounts();t.map(t=>t.address).indexOf(i.currentAddress)<0&&t[0]&&t[0].address&&(i.enableAccount(t[0].address),i.saveState({currentAddress:t[0].address})),e(i.currentWallet)}).catch(()=>{m("<p>Unable to connect.<br />User rejects wallet connection.</p>"),t(new Error("User cancel or reject connect to the wallet"))})})},getAccounts:async function(){return i.currentWallet||await i.getCurrentWallet(),"evm"===i.currentWalletType?(await i.currentWallet.request({method:"eth_accounts"})).map(t=>({address:t,name:t})):i.currentWallet.accounts.get()},enableAccount:function(t){i.currentAddress!==t&&i.saveState({currentAddress:t,currentSignMessage:void 0,currentVoteAbility:!1})},getSignMessage:async function(t){t=(await dotinsights.requestUtils.sendPost(dotinsights.Helpers.getApiEndpointUrl("getMessage"),{address:t})).message;i.saveState({currentSignMessage:t,currentVoteAbility:!0})},signMessage:async function(t){if(i.currentWallet||i.currentAddress)return"evm"===i.currentWalletType?i.currentWallet.request({method:"personal_sign",params:[t,i.currentAddress]}):i.currentWallet.signer.signRaw({address:i.currentAddress,data:t});throw new Error("Unable get current wallet or current account to sign message")},signVote:async function(t){try{if(i.currentWallet||await i.getCurrentWallet(),i.currentSignMessage&&i.currentVoteAbility||await i.getSignMessage(i.currentAddress),!i.currentVoteAbility)throw new Error("Unable to vote, required has balance on at least one chain in ecosystem");var e=await i.signMessage(i.currentSignMessage+"-"+t),n="object"==typeof e?e.signature:e;if("string"!=typeof n)throw new Error("Invalid signature");return n}catch(t){return console.error(t),!1}},runTestOnLoadPage(){setTimeout(async function(){i.loadSavedState();try{await i.isConnectedWithWallet()?(console.log("Enable existed wallet"),await i.enableWallet(i.currentWalletName),await i.getAccounts(),await i.currentAddress):console.log("Not connect with wallet")}catch(t){console.error("Connect wallet error: "+t.message)}},500)},runTestSelectWallet:function(){i.supportedWallets,Object.entries(i.supportedWallets).forEach(function([t,e]){console.log(e.name,i.isInstall(t)),console.log(e.name,t===i.currentWalletName)});i.enable("subwallet")},runTestSelectAccount:async function(){var t=await i.getAccounts();i.enableAccount(t[0].address)},runTestVoteProject:async function(){var t=await i.signVote("ProjectID");console.log(t)}};window.dotinsights=window.dotinsights||{},dotinsights.walletUtils=i,dotinsights.VotedProjects=[];var a=dotinsights.Helpers,c=o("#modal-connect-wallet"),r=o("#modal-show-error"),s=o("#modal-show-info"),d=c.find(".modal-content-body");function l(){setTimeout(async function(){i.loadSavedState();try{(await i.isConnectedWithWallet()?(await i.enableWallet(i.currentWalletName),"evm"===i.currentWalletType&&i.currentWallet.on("accountsChanged",t=>{(1===t.length||1<t.length&&!t.includes(i.currentAddress))&&i.enableAccount(t[0]),g()}),g):u)()}catch(t){console.error("Connect wallet error: "+t.message),u()}},500)}function u(){var t,e="";for(t in i.supportedWallets){var n=i.supportedWallets[t],a=i.isInstall(t),r="button button--wallet wallet--"+t;e+=`<a data-wallet="${t}" href="${a?"#":n.getInstallUrl()}" class="${r+=a?" btn-connect-wallet":" button-right-icon btn-install-wallet"}" ${a?"":' target="_blank"'}><span class="button-text">${n.name}</span>${a?"":'<span class="button-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.0625 10.3135L12 14.2499L15.9375 10.3135" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 3.75V14.2472" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M20.25 14.25V19.5C20.25 19.6989 20.171 19.8897 20.0303 20.0303C19.8897 20.171 19.6989 20.25 19.5 20.25H4.5C4.30109 20.25 4.11032 20.171 3.96967 20.0303C3.82902 19.8897 3.75 19.6989 3.75 19.5V14.25" stroke="#66E1B6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>'}</a>`}o(".btn-open-connect-wallet").find(".button-text span").text("Connect Wallet"),d.empty().html(e),c.find(".modal-title").text("Connect Your Wallet")}async function g(){for(var t=await i.getAccounts(),e=await i.currentAddress,n=null,a="",r=0;r<t.length;r++){var s=t[r],l="wallet-account-address";s.address===e&&(l+=" selected-account",n=s),a+=`<div class="${l}" data-address="${s.address}">
								<div class="wallet-icon"></div>
                                <div id="wallet-info">
                                    <div class="wallet-name text-1-row"><span>${s.name}</span></div>
                                    <div class="wallet-address text-1-row"><span>${s.address}</span></div>
                                </div>
							</div>`}a+='<div class="button-wrap btn-disconnect-wallet-wrap"><a href="#" class="button btn-disconnect-wallet"><span class="button-text">Disconnect</span></a></div>',o(".btn-open-connect-wallet").find(".button-text span").text(n.name),c.find(".modal-title").text("Choose account"),d.empty().html(a),p(e)}function p(t){o.ajax({method:"POST",url:a.getApiEndpointUrl("getVotedProject"),data:{address:t},success:function(t){dotinsights.VotedProjects=t,o(document.body).trigger("dotinsights/VotedProjects/Refreshed")}})}function m(t){r.find(".modal-error-message").html(t),r.dotinsightsModal("open")}c.dotinsightsModal(),o(document).ready(function(){o(document.body).on("click",".btn-connect-wallet",function(t){t.preventDefault();var e=o(this);a.setElementHandling(e),setTimeout(async function(){var t=e.data("wallet");try{await i.enableWallet(t),l()}catch(t){console.error(t),a.unsetElementHandling(e)}},500)}),o(document.body).on("click",".btn-disconnect-wallet",function(t){t.preventDefault();t=o(this);a.setElementHandling(t),setTimeout(function(){i.resetState(),l()},500)}),o(document.body).on("click",".btn-vote",function(t){t.preventDefault(),t.stopPropagation(),s.find(".modal-message").html("<p>Voting coming soon!</p>"),s.dotinsightsModal("open")}),o(document.body).on("click",".wallet-account-address",function(t){t.preventDefault(),t.stopPropagation(),o(this).hasClass("selected-account")||async function(t){var e=await i.getAccounts();for(var n=t.data("address"),a=0;a<e.length;a++)if(n===e[a].address){i.enableAccount(n),t.siblings().removeClass("selected-account"),t.addClass("selected-account"),o(".btn-open-connect-wallet").find(".button-text span").text(e[a].name),p(n),c.dotinsightsModal("close");break}}(o(this))}),l()}),o(document.body).on("dotinsights/VotedProjects/Refreshed",function(){if(o(".btn-vote").addClass("vote-this").removeClass("unvote-this"),0<dotinsights.VotedProjects.length)for(var t=0;t<dotinsights.VotedProjects.length;t++)o('.btn-vote[data-project-id="'+dotinsights.VotedProjects[t]+'"]').removeClass("vote-this").addClass("unvote-this")})}(jQuery);